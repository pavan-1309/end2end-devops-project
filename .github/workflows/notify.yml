name: Build Status Notification

on:
  workflow_run:
    workflows: ["Microservices CI/CD Pipeline"]
    types:
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion != 'success' }}
    
    steps:
    - name: Send Failure Email
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.EMAIL_USERNAME }}
        password: ${{ secrets.EMAIL_PASSWORD }}
        subject: "❌ Build Failed: ${{ github.repository }}"
        to: ${{ secrets.EMAIL_TO }}
        from: ${{ secrets.EMAIL_USERNAME }}
        body: |
          ## ❌ Build Failed
          
          **Repository:** ${{ github.repository }}
          **Branch:** ${{ github.event.workflow_run.head_branch }}
          **Commit:** ${{ github.event.workflow_run.head_sha }}
          **Status:** ${{ github.event.workflow_run.conclusion }}
          
          **Action Required:** Please check the build logs and fix the issues.
          
          **View Logs:** https://github.com/${{ github.repository }}/actions/runs/${{ github.event.workflow_run.id }}